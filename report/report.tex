%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Stylish Article
% LaTeX Template
% Version 2.2 (2020-10-22)
%
% This template has been downloaded from:
% http://www.LaTeXTemplates.com
%
% Original author:
% Mathias Legrand (legrand.mathias@gmail.com) 
% With extensive modifications by:
% Vel (vel@latextemplates.com)
%
% License:
% CC BY-NC-SA 3.0 (http://creativecommons.org/licenses/by-nc-sa/3.0/)
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%----------------------------------------------------------------------------------------
%	PACKAGES AND OTHER DOCUMENT CONFIGURATIONS
%----------------------------------------------------------------------------------------

\documentclass[fleqn, 10pt]{SelfArx} % Document font size and equations flushed left

\usepackage[english]{babel} % Specify a different language here - english by default

\usepackage{lipsum} % Required to insert dummy text. To be removed otherwise

\usepackage{array} % Required for centering tables content

\usepackage{float} % Avoid putting tables on top of the pages

\graphicspath{ {./images/} } % Paths were images are taken

%----------------------------------------------------------------------------------------
%	COLUMNS
%----------------------------------------------------------------------------------------

\setlength{\columnsep}{0.55cm} % Distance between the two columns of text
\setlength{\fboxrule}{0.75pt} % Width of the border around the abstract

%----------------------------------------------------------------------------------------
%	COLORS
%----------------------------------------------------------------------------------------

\definecolor{color1}{RGB}{0,0,90} % Color of the article title and sections
\definecolor{color2}{RGB}{0,20,20} % Color of the boxes behind the abstract and headings

%----------------------------------------------------------------------------------------
%	HYPERLINKS
%----------------------------------------------------------------------------------------

\usepackage{hyperref} % Required for hyperlinks

\hypersetup{
	hidelinks,
	colorlinks,
	breaklinks=true,
	urlcolor=color2,
	citecolor=color1,
	linkcolor=color1,
	bookmarksopen=false,
	pdftitle={Title},
	pdfauthor={Author},
}

\setlength{\parindent}{0cm} % Remove left padding from text

\newcolumntype{C}[1]{>{\centering\arraybackslash}p{#1}} % centering columns values

%----------------------------------------------------------------------------------------
%	ARTICLE INFORMATION
%----------------------------------------------------------------------------------------

\JournalInfo{\today -- v.1.0} % Journal information
\Archive{\textcopyright 2022/23} % Additional notes (e.g. copyright, DOI, review/research article)

\PaperTitle{DDoS attack, through mDNS} % Article title

\Authors{A. Al Masoud\textsuperscript{1}, F. Amato\textsuperscript{2}, A. Blindu\textsuperscript{3}, D. Lotito\textsuperscript{4}, D. Ragusa\textsuperscript{5}} % Authors
\affiliation{\textsuperscript{1}\textit{Department of Computer Engineering, University of Pavia, Pavia, Italy}} % Author affiliation
\affiliation{\textsuperscript{2}\textit{Enterprise Digital Infrastructure}} % Author affiliation
\affiliation{\textbf{Corresponding author}: francesco.amato01@universitadipavia.it} % Corresponding author

\Keywords{\small{DDoS -- mDNS -- Botnet -- Security}} % Keywords - if you don't want any simply remove all the text between the curly brackets
\newcommand{\keywordname}{Keywords} % Defines the keywords heading name

%----------------------------------------------------------------------------------------
%	ABSTRACT
%----------------------------------------------------------------------------------------

\Abstract{The aim of this report is to implement a DDoS attack, based on the mDNS protocol. 
In addition, the generated traffic has been analyzed, and some studies have been conducted, 
in order to understand the impact of this kind of DDoS attack under different conditions.}

%----------------------------------------------------------------------------------------

\begin{document}

\maketitle % Output the title and abstract box

\tableofcontents % Output the contents section

\thispagestyle{empty} % Removes page numbering from the first page

%----------------------------------------------------------------------------------------
%	INTRODUCTION
%----------------------------------------------------------------------------------------

\section*{Introduction} % The \section*{} command stops section numbering

\addcontentsline{toc}{section}{Introduction} % Adds this section to the table of contents

The idea for this project is to perform a Distributed Denial Of Service attack (DDoS) \cite{DDoS} using the Multicast Domain Name System (mDNS) \cite{rfc6762}.\\
For those who are not familiar with these concepts, a brief discussion about DDoS and its principles is explained below.
A DDoS attack is when an attacker is attempting to make it impossible for a target service, or multiple services, to be properly delivered.\\
In this types of attacks, itâ€™s one system that is sending the malicious data or requests; a DDoS attack comes from multiple systems.\\
Generally, these attacks work by overwhelming a system with requests for data. This could be sending a web server so many requests to serve a page that it crashes under the demand, or small requests that are amplificated by providing a huge response. \\ The result is that available internet bandwidth and the resources of the target system become overloaded.\\
In this project mDNS has been exploited in order to perform a DDoS attack. The starting hypothesis is that the botmaster and its malicious devices are within the same network of the target. In order to overload the network the attacker sends a query in multicast to all the devices inside the network according to the mDNS protocol. \\ The devices respond in multicast and the result is that the network availability, its bandwith and the mDNS service are compromised. \\
In order to understand how we exploited the mDNS for the DDoS attack, an explanation of how this protocol works is provied below.

%----------------------------------------------------------------------------------------
%	mDNS protocol
%----------------------------------------------------------------------------------------


\section{mDNS protocol}
Multicast DNS (mDNS) is a service that aims to solve name resolution in smaller networks. It takes a different approach than the well-known DNS: instead of sending requests to a name server, the network participants are all contacted directly.
The corresponding client sends a multicast into the network and asks which network participant the host name corresponds to. \\
In this way, the request also reaches the member of the group that has the searched hostname. This responds to the entire network, again via multicast. Moreover, all participants are informed about the name and IP address connection and can make a corresponding entry in their mDNS cache. \\
Multicast DNS causes relatively high traffic, but actively tries to conserve network resources: to this end, the requesting client sends the correct response according to its opinion (i.e. according to the current cache entry). \\ Only if this is no longer correct, or if the entry is about to expire, does the recipient have to respond. \\
In general, only hostnames ending with {\it{.local}} can be used with Multicast DNS. In addition, it is relies on top of UDP layer.\\
The mDNS was developed in the context of Zeroconf (Zero Configuration Networking) using essentially the same programming interfaces, packet formats, and operating semantics as the unicast Domain Name Service (DNS). The idea behind Zero Configuration Networking is to allow computers to communicate with each other without the need for prior configuration.\\
A popular implementation of mDNS is Bonjour by Apple, also the open source software Avahi can now be used as an mDNS service. As of Windows 10, mDNS is also available in Microsoft's operating system.

\paragraph{Advantages} 
\begin{itemize}[leftmargin=*]
    \item Since all devices share their IP addresses, there is no need to configure a server or directory. This makes it possible to add additional devices very dynamically and quickly.
\end{itemize}

\paragraph{Disadvantages} 
\begin{itemize}[leftmargin=*]
    \item One problem lies in the Multicast procedure itself. Although the protocol tries to keep network traffic low, participating computers must constantly monitor the network and process incoming messages. This requires computing power.
    \item Assigning host names is problematic: since you can freely choose a name for each device, as long as it ends in {\it{.local}}, this can (at least theoretically) lead to two network devices with the same host name.\\
          The developers of mDNS have deliberately not proposed a solution to this problem. On the one hand, it is assumed that the case rarely occurs; on the other hand, the double naming may be intentional. Also, by default, mDNS only resolves hostnames that end with the {\it{.local}} top-level domain. \\
          This can cause problems if {\it{.local}} includes hosts that do not implement mDNS but can be found via a conventional unicast DNS server. Resolving such conflicts requires network configuration changes that mDNS is designed to avoid.
    \item In some cases, mDNS is open. This means that it also responds to requests from outside (the Internet). Attackers can find such open services and use them for DDoS attacks, using network devices improperly and targeting a server. In addition, in a DNS Multicast even sensitive data can be detected. 
	      This allows attackers to know information about connected devices and use it for further attacks.
\end{itemize}

\subsection{Packets structure}
An mDNS message is a UDP packet sent in multicast using the following addressing:
\begin{itemize}[leftmargin=*]
    \item IPv4 address 224.0.0.251 or IPv6 address ff02::fb
    \item UDP port 5353
    \item When using Ethernet frames, the standard IP multicast MAC address 01:00:5E:00:00:FB (for IPv4) \\or 33:33:00:00:FB (for IPv6)
\end{itemize}
The payload structure is based on the unicast DNS packet format, which consists of two parts: the header and the data.\\
The header is identical to the one found in the unicast DNS, as are the subsections in the data part: queries, responses, authoritative-nameservers, and additional records. The number of records in each subsection corresponds to the value of the corresponding {\it{COUNT}} field in the header.

\subsection{Queries}
The format of the records in the query section is a bit different from that of classic DNS by adding a single-bit {\it{UNICAST-RESPONSE}} field.
The payload structure is based on the unicast DNS packet format, which consists of two parts: the header and the data.

\begin{table}[hbt]
	\centering
	\begin{tabular}{|C{2cm}|C{2.8cm}|C{1.5cm}|}
		\hline
		Field & Description & Lenght \\
		\hline
		\hline
		QNAME & Name of the node to which the query pertains & Variable \\
		\hline
		QTYPE &	The type of the query &	16 \\
		\hline
		UNICAST-RESPONSE & Boolean flag indicating whether a unicast-response is desired & 1\\
		\hline
		QCLASS & IN & 15 \\
		\hline
	\end{tabular}
	\caption{Query structure}
\end{table}

The {\it{UNICAST-RESPONSE}} field is used to minimize unnecessary transmissions over the network: if the bit is set, responders should send a direct-unicast 
response directly to the requesting node rather than broadcasting the response to the entire network.\\
The {\it{QCLASS}} field is identical to that found in unicast DNS ({\it{IN}} class).

\subsection{Resource Records}
All records in the answers, authoritative-nameservers, and additional records sections have the same format and are known collectively as Resource Records (RR) \cite{rfc4034}.\\
The general format of RRs in mDNS is slightly different from classic DNS, as shown in the table \ref{table}. % -- PLEASE DO NOT REMOVE THIS COMMENT.

\begin{table}[hbt]
	\centering
	\begin{tabular}{|C{1.7cm}|C{4.2cm}|C{1cm}|}
		\hline
		Field & Description & Lenght \\
		\hline
		\hline
		RRNAME & Name of the node to which the record pertains & Variable\\
		\hline
		RRTYPE & The type of the Resource Record & 16\\
		\hline
		CACHE-FLUSH & Boolean flag indicating whether outdated cached records should be purged & 1\\
		\hline
		RRCLASS & Class code, 1 a.k.a. IN for the Internet and IP networks & 15\\
		\hline
		TTL & Time interval (in seconds) that the RR should be cached & 32\\
		\hline
		RDLENGTH & Integer representing the length (in octets) of the RDATA field & 16\\
		\hline
		RDATA & Resource data; internal structure varies by RRTYPE & Variable\\
		\hline
	\end{tabular}
	\caption{Resource Records}
	 \label{table} % -- PLEASE DO NOT REMOVE THIS COMMENT
\end{table}

The {\it{CACHE-FLUSH}} bit is used to instruct neighboring nodes that the record should overwrite, rather than be added to any existing cache entry for this {\it{RRNAME}} and {\it{RRTYPE}}.

%----------------------------------------------------------------------------------------
%	EXPERIMENT
%----------------------------------------------------------------------------------------

\section{Experiment}
The aim of this section is taking into account the implemented mDNS DDoS attack solution, and consider the different parts of the script
(GitHub repository \cite{repo}).

\subsection{How to start the attack}
Once the repository is cloned on your own device, the easiest way to start the script is by executing the following command, on your terminal (remember to move within the same folder
in which you cloned this repo):

\begin{scriptsize}
	\begin{verbatim}
	$ python3 src/scripton.py -t TARGET_IP 
	\end{verbatim}
\end{scriptsize}

Where the {\it{target}} is the device, to be compromised, connected within your network.
This parameter is the only one mandatory in order to start the DDoS over mDNS attack.\\
The main goal is to compromise both the target and the service on which the DDoS is based. 
As a result of this, the other devices connected within the same network of the target will 
also suffer from side effects, in a more or less visible way, depending on the extent and power of the assault
(e.g., unable to reach and use completely or partially the mDNS service, the network is overloaded due to the huge quantity of the traffic ganerated, \dots).\\
Other parameters can be specified, such as:
\begin{itemize}[leftmargin=*]
    \item {\it{RRTYPE}} (-rr or - -type, default type ANY), which are the RR types used in order to send particular mDNS requests to the target device
    \item {\it{Spoofed IP} \cite{SPOOFING}} (-i or - -spoofed-ip, default NONE), in order to avoid that to prevent network administrators from tracing to whom the real device started the attack, 
	the IP of our machine (or devices connected to the botnet \cite{BOTNET}, whose term indicates a set of infected devices, always ready to listen and perform the commands of the head of the botnet) is changed to one of another device connected within the same target's network (for example a friend, relative, colleague, \dots).\\
	If the primary objective of the attack is to compromise the target device (and not only the network, or mDNS service) it is necessary that all the botnet devices have spoofed their IP, 
	so that the target device has a huge mDNS traffic to manage.
    \item {\it{Number of threads}} (-n or - -nthreads, default 1), this parameter is setted to create a higher level of parallelism (using multi-threading \cite{THREAD}), with the aim of increasing the number of mDNS requests that can be performed to the target device in a second. \\
    If a botnet is not used, the power of the attack depends only on the computing power (therefore number of cores) of the device from which the attack starts (the more the number of cores the greater the amount of traffic generated). \\
	Furthermore, if the same script runs simultaneously on multiple devices, using the same spoofed IP and the same IP target (of course botmaster and botnet must be connected within the same network) and exploiting the full computing power of each infected network node, the order of magnitude of the attack can be very devastating.
\end{itemize}

The complete command, using all the parameters, should be executed as follows (a single line in the terminal/prompt):

\begin{scriptsize}
	\begin{verbatim}
	$ python3 src/scripton.py -t $TARGET_IP -rr $RR_TYPE
	  -i $SPOOFED_IP -n $NUM_THREADS 
	\end{verbatim}
\end{scriptsize}

\subsection{Python script behavior analysis}

%----------------------------------------------------------------------------------------
%	RESULTS
%----------------------------------------------------------------------------------------

\section{Results}
The objective of this section is discussing about the results that have been achieved by the implemented DDoS attack.

\subsection{Generated traffic}

\subsection{Statistical investigations}


%----------------------------------------------------------------------------------------
%	MITIGATION/PREVENTION
%----------------------------------------------------------------------------------------

\section{Ways to mitigate or prevent}
But how is possible to prevent or mitigate DDoS attacks, and more specifically DDoS over mDNS protocol? \\
Many solutions are here discussed.

%----------------------------------------------------------------------------------------
%	REFERENCE LIST
%----------------------------------------------------------------------------------------

\phantomsection
\bibliographystyle{unsrt}
\bibliography{mybibl.bib}
\nocite{*}

%----------------------------------------------------------------------------------------

\end{document}